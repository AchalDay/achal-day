<script>
let step = 0;
let chatData = JSON.parse(localStorage.getItem("achalChat")) || [];

const chat = document.getElementById("chat");
const input = document.getElementById("input");

const humanReplies = {
  greeting: [
    "Hey ðŸ™‚ Iâ€™m here.",
    "Hi. Iâ€™m with you.",
    "Hello ðŸŒ± Take a breath."
  ],
  feelingGood: [
    "Thatâ€™s good to hear.",
    "Nice ðŸ™‚ Letâ€™s keep that energy.",
    "Glad youâ€™re feeling okay."
  ],
  feelingTired: [
    "Thanks for telling me.",
    "Thatâ€™s okay. Weâ€™ll go slow today.",
    "Got it. No pressure then."
  ],
  encourage: [
    "Thatâ€™s enough for today.",
    "You donâ€™t need to do everything.",
    "One step is more than enough."
  ]
};

function random(arr) {
  return arr[Math.floor(Math.random() * arr.length)];
}

function renderChat() {
  chat.innerHTML = "";
  chatData.forEach(m => {
    const div = document.createElement("div");
    div.className = "msg " + m.type;
    div.innerHTML = m.text;
    chat.appendChild(div);
  });
  chat.scrollTop = chat.scrollHeight;
}

function saveChat() {
  localStorage.setItem("achalChat", JSON.stringify(chatData));
}

function addMsg(text, type) {
  chatData.push({ text, type });
  saveChat();
  renderChat();
}

if (chatData.length === 0) {
  addMsg(random(humanReplies.greeting) + "<br>Want to plan your day together?", "bot");
}

input.addEventListener("keypress", function(e) {
  if (e.key === "Enter") {
    const text = this.value.trim();
    if (!text) return;

    addMsg(text, "user");
    this.value = "";

    setTimeout(() => respond(text.toLowerCase()), 500);
  }
});

function respond(text) {
  if (step === 0) {
    if (text.includes("good") || text.includes("fine") || text.includes("ok")) {
      addMsg(random(humanReplies.feelingGood), "bot");
    } else if (text.includes("tired") || text.includes("bad") || text.includes("not")) {
      addMsg(random(humanReplies.feelingTired), "bot");
    } else {
      addMsg("Thanks for sharing that.", "bot");
    }

    addMsg("Letâ€™s keep today light.<br>What are <b>3 things</b> you want to take care of?", "bot");
    step = 1;

  } else if (step === 1) {
    addMsg("Okay. Iâ€™ve got that.", "bot");
    addMsg(random(humanReplies.encourage) + "<br>Iâ€™m here if you need me later ðŸŒ±", "bot");
    step = 2;

  } else {
    addMsg("Iâ€™m still here. Talk to me anytime.", "bot");
  }
}

function resetChat() {
  localStorage.removeItem("achalChat");
  chatData = [];
  step = 0;
  renderChat();
  addMsg(random(humanReplies.greeting) + "<br>Want to plan your day together?", "bot");
}

renderChat();
</script>
  
